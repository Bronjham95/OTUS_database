# HOMEWORK #13. DML: агрегация и сортировка.

### 1. группировки с ипользованием CASE, HAVING, ROLLUP, GROUPING() ; для магазина к предыдущему списку продуктов добавить максимальную и минимальную цену и кол-во предложений; сделать выборку показывающую самый дорогой и самый дешевый товар в каждой; категории сделать rollup с количеством товаров по категориям.

```sql
/* 
Соберем данные в "обертку" из 3 таблиц:
-> название продукта (Product)
-> стоимость (Product)
-> категория товара (Category)
-> сформированная партия для отправки (Shipment), в шт.
*/
with cte_list as (
select
p.product_name,
p.list_price,
c.category_name,
s.part_quantity
from product p
join shipment s on s.id = p.part_id
join category c on c.id = p.category_id
) 
select
if(GROUPING (category_name), 'All results', category_name) category_name ,
sum(case when product_name <> 'pepperoni' then part_quantity else 0 end) v_sum1,
sum(part_quantity) v_sum2,
min(list_price) v_min,
max(list_price) v_max
from cte_list
group by category_name WITH ROLLUP
having v_min > 5;
```
> Итог [_v_sum1 - используя case, v_sum2 - игнорируем_]:

> Можно обратить внимание, что стало на 10 шт. меньше. 

![Alt text](12-1.png)

> Для проверки (из каких данных производилась группировка):
![Alt text](12-2.png)
